#+TITLE: Performance in the Dual Task
#+STARTUP: fold
#+PROPERTY: header-args:ipython :results both :exports both :async yes :session dual_data :kernel dual_data

* Notebook Settings
#+begin_src ipython
  %load_ext autoreload
  %autoreload 2
  %reload_ext autoreload

  %run /home/leon/models/lif_cpp/notebooks/setup.py
  %matplotlib inline
  %config InlineBackend.figure_format = 'png'
#+end_src

#+RESULTS:
: The autoreload extension is already loaded. To reload it, use:
:   %reload_ext autoreload
: Python exe
: /home/leon/mambaforge/envs/dual_data/bin/python

* Imports
#+begin_src ipython
  import sys
  sys.path.insert(0, '../')
  from dual_data.performance.perf_tasks import run_perf_tasks
  from dual_data.common.fig_grid import create_grid
#+end_src

#+RESULTS:

* Performance
** Single Mouse
#+begin_src ipython :
  run_perf_tasks(mouse='PP09', perf_type='correct', reload=0)
#+end_src

#+RESULTS:
:RESULTS:
: loading files from /home/leon/dual_task/dual_data/data/PP09
: reading raw data
# [goto error]
#+begin_example
  [0;31m---------------------------------------------------------------------------[0m
  [0;31mAssertionError[0m                            Traceback (most recent call last)
  Cell [0;32mIn[18], line 1[0m
  [0;32m----> 1[0m [43mrun_perf_tasks[49m[43m([49m[43mmouse[49m[38;5;241;43m=[39;49m[38;5;124;43m'[39;49m[38;5;124;43mPP09[39;49m[38;5;124;43m'[39;49m[43m,[49m[43m [49m[43mperf_type[49m[38;5;241;43m=[39;49m[38;5;124;43m'[39;49m[38;5;124;43mcorrect[39;49m[38;5;124;43m'[39;49m[43m,[49m[43m [49m[43mreload[49m[38;5;241;43m=[39;49m[38;5;241;43m0[39;49m[43m)[49m

  File [0;32m~/dual_task/dual_data/org/../dual_data/performance/perf_tasks.py:79[0m, in [0;36mrun_perf_tasks[0;34m(**kwargs)[0m
  [1;32m     76[0m     _, y_days [38;5;241m=[39m get_X_y_mice(IF_RELOAD[38;5;241m=[39moptions[[38;5;124m"[39m[38;5;124mreload[39m[38;5;124m"[39m])
  [1;32m     77[0m [38;5;28;01melse[39;00m:
  [1;32m     78[0m     [38;5;66;03m# _, y_days = get_X_y_days(options["mouse"], IF_RELOAD=options["reload"])[39;00m
  [0;32m---> 79[0m     _, y_days [38;5;241m=[39m [43mget_X_y_days[49m[43m([49m[38;5;241;43m*[39;49m[38;5;241;43m*[39;49m[43moptions[49m[43m)[49m
  [1;32m     81[0m perf_type [38;5;241m=[39m options[[38;5;124m"[39m[38;5;124mperf_type[39m[38;5;124m"[39m]
  [1;32m     82[0m sample [38;5;241m=[39m options[[38;5;124m"[39m[38;5;124msample[39m[38;5;124m"[39m]

  File [0;32m~/dual_task/dual_data/org/../dual_data/common/get_data.py:254[0m, in [0;36mget_X_y_days[0;34m(**kwargs)[0m
  [1;32m    251[0m y_days [38;5;241m=[39m []
  [1;32m    253[0m [38;5;28;01mfor[39;00m day [38;5;129;01min[39;00m days:
  [0;32m--> 254[0m     X, y [38;5;241m=[39m [43mget_fluo_data[49m[43m([49m[43midx_day[49m[38;5;241;43m=[39;49m[43mday[49m[43m,[49m[43m [49m[38;5;241;43m*[39;49m[38;5;241;43m*[39;49m[43mkwargs[49m[43m)[49m
  [1;32m    255[0m     [38;5;28mprint[39m([38;5;124m"[39m[38;5;124mX[39m[38;5;124m"[39m, X[38;5;241m.[39mshape, [38;5;124m"[39m[38;5;124my[39m[38;5;124m"[39m, y[38;5;241m.[39mshape)
  [1;32m    257[0m     y_df [38;5;241m=[39m create_df(y, day[38;5;241m=[39mday)

  File [0;32m~/dual_task/dual_data/org/../dual_data/common/get_data.py:107[0m, in [0;36mget_fluo_data[0;34m(idx_day, **kwargs)[0m
  [1;32m    105[0m     data [38;5;241m=[39m loadmat(path [38;5;241m+[39m [38;5;124m"[39m[38;5;124m/[39m[38;5;124m"[39m [38;5;241m+[39m mouse [38;5;241m+[39m [38;5;124m"[39m[38;5;124m/SamedROI/[39m[38;5;124m"[39m [38;5;241m+[39m mouse [38;5;241m+[39m [38;5;124m"[39m[38;5;124m_all_days[39m[38;5;124m"[39m [38;5;241m+[39m [38;5;124m"[39m[38;5;124m.mat[39m[38;5;124m"[39m)
  [1;32m    106[0m [38;5;28;01mif[39;00m [38;5;124m"[39m[38;5;124mPP[39m[38;5;124m"[39m [38;5;129;01min[39;00m mouse:
  [0;32m--> 107[0m     data [38;5;241m=[39m [43mmat73[49m[38;5;241;43m.[39;49m[43mloadmat[49m[43m([49m
  [1;32m    108[0m [43m        [49m[43mpath[49m
  [1;32m    109[0m [43m        [49m[38;5;241;43m+[39;49m[43m [49m[38;5;124;43m"[39;49m[38;5;124;43m/[39;49m[38;5;124;43m"[39;49m
  [1;32m    110[0m [43m        [49m[38;5;241;43m+[39;49m[43m [49m[43mmouse[49m
  [1;32m    111[0m [43m        [49m[38;5;241;43m+[39;49m[43m [49m[38;5;124;43m"[39;49m[38;5;124;43m/SamedROI_10Days/[39;49m[38;5;124;43m"[39;49m
  [1;32m    112[0m [43m        [49m[38;5;241;43m+[39;49m[43m [49m[38;5;124;43m"[39;49m[38;5;124;43mDay0[39;49m[38;5;124;43m"[39;49m
  [1;32m    113[0m [43m        [49m[38;5;241;43m+[39;49m[43m [49m[38;5;28;43mstr[39;49m[43m([49m[43midx_day[49m[43m)[49m
  [1;32m    114[0m [43m        [49m[38;5;241;43m+[39;49m[43m [49m[38;5;124;43m"[39;49m[38;5;124;43mDFF_Data01.mat[39;49m[38;5;124;43m"[39;49m
  [1;32m    115[0m [43m    [49m[43m)[49m
  [1;32m    116[0m [38;5;28;01melse[39;00m:
  [1;32m    117[0m     data [38;5;241m=[39m loadmat(
  [1;32m    118[0m         path
  [1;32m    119[0m         [38;5;241m+[39m [38;5;124m"[39m[38;5;124m/[39m[38;5;124m"[39m
  [0;32m   (...)[0m
  [1;32m    125[0m         [38;5;241m+[39m [38;5;124m"[39m[38;5;124m.mat[39m[38;5;124m"[39m
  [1;32m    126[0m     )

  File [0;32m~/mambaforge/envs/dual_data/lib/python3.8/site-packages/mat73/core.py:312[0m, in [0;36mloadmat[0;34m(filename, use_attrdict, only_include, verbose)[0m
  [1;32m    293[0m [38;5;28;01mdef[39;00m [38;5;21mloadmat[39m(filename, use_attrdict[38;5;241m=[39m[38;5;28;01mFalse[39;00m, only_include[38;5;241m=[39m[38;5;28;01mNone[39;00m, verbose[38;5;241m=[39m[38;5;28;01mTrue[39;00m):
  [1;32m    294[0m [38;5;250m    [39m[38;5;124;03m"""[39;00m
  [1;32m    295[0m [38;5;124;03m    Loads a MATLAB 7.3 .mat file, which is actually a[39;00m
  [1;32m    296[0m [38;5;124;03m    HDF5 file with some custom matlab annotations inside[39;00m
  [0;32m   (...)[0m
  [1;32m    310[0m [38;5;124;03m    :returns: A dictionary with the matlab variables loaded[39;00m
  [1;32m    311[0m [38;5;124;03m    """[39;00m
  [0;32m--> 312[0m     [38;5;28;01massert[39;00m os[38;5;241m.[39mpath[38;5;241m.[39misfile(filename), [38;5;124m'[39m[38;5;132;01m{}[39;00m[38;5;124m does not exist[39m[38;5;124m'[39m[38;5;241m.[39mformat(filename)
  [1;32m    313[0m     decoder [38;5;241m=[39m HDF5Decoder(verbose[38;5;241m=[39mverbose, use_attrdict[38;5;241m=[39muse_attrdict,
  [1;32m    314[0m                           only_include[38;5;241m=[39monly_include)
  [1;32m    316[0m     ext [38;5;241m=[39m os[38;5;241m.[39mpath[38;5;241m.[39msplitext(filename)[[38;5;241m1[39m][38;5;241m.[39mlower()

  [0;31mAssertionError[0m: /home/leon/dual_task/dual_data/data//PP09/SamedROI_10Days/Day01DFF_Data01.mat does not exist
#+end_example
:END:
** All Mice
#+begin_src ipython
  mice = ['ChRM04','JawsM15', 'JawsM18', 'ACCM03', 'ACCM04', 'AP02', 'AP12']
  # mice = ['ChRM04','JawsM15', 'JawsM18']
  for mouse in mice:
        run_perf_tasks(mouse=mouse, perf_type='correct', reload=0)
        plt.close('all')       
#+end_src

#+RESULTS:
#+begin_example
  loading files from /home/leon/dual_task/dual_data/data/ChRM04
  X_days (1152, 668, 84) y_days (1152, 6)
  ##########################################
  PREPROCESSING: SCALER robust AVG MEAN 0 AVG NOISE True UNIT VAR False
  ##########################################
  DPA 1152 (1152, 6) (192, 6)
  DualGo 1152 (1152, 6) (192, 6)
  DualNoGo 1152 (1152, 6) (192, 6)
  loading files from /home/leon/dual_task/dual_data/data/JawsM15
  X_days (1152, 693, 84) y_days (1152, 6)
  ##########################################
  PREPROCESSING: SCALER robust AVG MEAN 0 AVG NOISE True UNIT VAR False
  ##########################################
  DPA 1152 (1152, 6) (192, 6)
  DualGo 1152 (1152, 6) (192, 6)
  DualNoGo 1152 (1152, 6) (192, 6)
  loading files from /home/leon/dual_task/dual_data/data/JawsM18
  X_days (1152, 444, 84) y_days (1152, 6)
  ##########################################
  PREPROCESSING: SCALER robust AVG MEAN 0 AVG NOISE True UNIT VAR False
  ##########################################
  DPA 1152 (1152, 6) (192, 6)
  DualGo 1152 (1152, 6) (192, 6)
  DualNoGo 1152 (1152, 6) (192, 6)
  loading files from /home/leon/dual_task/dual_data/data/ACCM03
  X_days (960, 361, 84) y_days (960, 6)
  ##########################################
  PREPROCESSING: SCALER robust AVG MEAN 0 AVG NOISE True UNIT VAR False
  ##########################################
  DPA 960 (960, 6) (320, 6)
  DualGo 960 (960, 6) (320, 6)
  DualNoGo 960 (960, 6) (320, 6)
  loading files from /home/leon/dual_task/dual_data/data/ACCM04
  X_days (960, 113, 84) y_days (960, 6)
  ##########################################
  PREPROCESSING: SCALER robust AVG MEAN 0 AVG NOISE True UNIT VAR False
  ##########################################
  DPA 960 (960, 6) (320, 6)
  DualGo 960 (960, 6) (320, 6)
  DualNoGo 960 (960, 6) (320, 6)
  loading files from /home/leon/dual_task/dual_data/data/AP02
  X_days (1848, 702, 115) y_days (1848, 6)
  ##########################################
  PREPROCESSING: SCALER robust AVG MEAN 0 AVG NOISE True UNIT VAR False
  ##########################################
  DPA 1848 (1848, 6) (336, 6)
  DualGo 1848 (1848, 6) (672, 6)
  DualNoGo 1848 (1848, 6) (672, 6)
  loading files from /home/leon/dual_task/dual_data/data/AP12
  X_days (1848, 741, 115) y_days (1848, 6)
  ##########################################
  PREPROCESSING: SCALER robust AVG MEAN 0 AVG NOISE True UNIT VAR False
  ##########################################
  DPA 1848 (1848, 6) (336, 6)
  DualGo 1848 (1848, 6) (672, 6)
  DualNoGo 1848 (1848, 6) (672, 6)
#+end_example
* Summary
#+begin_src ipython
  def figname(mouse):
      return mouse + "_behavior_tasks_correct" + ".svg"
  
  figlist = ['../figs/' + figname(mouse) for mouse in mice]
  print(figlist)

  golden_ratio = (5**.5 - 1) / 2
  width = 4.3
  height = width * golden_ratio * 1.4
  figsize = [width, height]
  matplotlib.rcParams['lines.markersize'] = 5.5

  create_grid(figlist, "../figs/performance_all_mice.svg", dim=[3,3], fontsize=22)

#+end_src

#+RESULTS:
: ['../figs/ChRM04_behavior_tasks_correct.svg', '../figs/JawsM15_behavior_tasks_correct.svg', '../figs/JawsM18_behavior_tasks_correct.svg', '../figs/ACCM03_behavior_tasks_correct.svg', '../figs/ACCM04_behavior_tasks_correct.svg', '../figs/AP02_behavior_tasks_correct.svg', '../figs/AP12_behavior_tasks_correct.svg']
: 504.0 311.48913
: ['1512pt', '934pt']

#+NAME: fig:temporal_decoding
#+CAPTION: Temporal Decoding
#+ATTR_ORG: :width 1200
#+ATTR_LATEX: :width 5in
[[file:../figs/performance_all_mice.svg]]
